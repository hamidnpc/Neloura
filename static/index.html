<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--
      Caching notes:
      - Real Cache-Control headers must be set in your web server/CDN.
      - These meta tags help reduce HTML caching in many browsers/proxies.
      - For JS/CSS, we append ?v=... to force browsers to revalidate/refetch after deploy.
        Bump APP_ASSET_VERSION on each deploy.
    -->
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script>
      // Bump this value on each deployment to force-refresh JS/CSS in user browsers.
      window.APP_ASSET_VERSION = "20260127-02";
    </script>
    <title>Neloura</title>
    <link rel="stylesheet" href="/static/style.css?v=20260127-02">
    <script src="/static/vendor/openseadragon/openseadragon.min.js?v=20260127-02"></script>
    <link rel="stylesheet" href="/static/vendor/codemirror/codemirror.min.css?v=20260127-02">
    <link rel="stylesheet" href="/static/vendor/codemirror/theme/dracula.min.css?v=20260127-02">
    <link rel="stylesheet" href="/static/vendor/codemirror/addon/hint/show-hint.min.css?v=20260127-02">
    <!-- Required libraries for WCS overlay -->
    <script src="/static/vendor/fabric/fabric.min.js?v=20260127-02"></script>
    <link rel="stylesheet" href="/static/progress.css?v=20260127-02">

    <script defer src="/static/peak.js?v=20260127-02"></script>
    <script defer src="/static/image-processing.js?v=20260127-02"></script>
    <script defer src="/static/main.js?v=20260127-02"></script>
    <script defer src="/static/coords_overlay.js?v=20260127-02"></script>
    <script defer src="/static/sed.js?v=20260127-02"></script>
    <script defer src="/static/plotter.js?v=20260127-02"></script>
    <script defer src="/static/asttest.js?v=20260127-02"></script>
    <script defer src="/static/catalogs.js?v=20260127-02"></script>
    <script defer src="/static/catalog_webgl.js?v=20260127-02"></script>
    <script defer src="/static/files.js?v=20260127-02"></script>
    <script defer src="/static/mast.js?v=20260127-02"></script>
    <script defer src="/static/canvas.js?v=20260127-02"></script>
    <script>
      (function(){
        fetch('/settings/me').then(r=>r.json()).then(me=>{
          if (me && me.admin) {
            var s=document.createElement('script'); s.defer=true; s.src='/static/local_coding.js?v=20260127-02'; document.head.appendChild(s);
          }
        }).catch(()=>{});
      })();
    </script>
    <script defer src="/static/settings.js?v=20260127-02"></script>
    <script defer src="/static/save.js?v=20260127-02"></script>
    <script defer src="/static/toolbar.js?v=20260127-02"></script>
    <!-- plot3d removed -->
    <script defer src="/static/wcs.js?v=20260127-02"></script>

    <script src="/static/catalog_viewer.js?v=20260127-02"></script>
    <script src="/static/vendor/codemirror/codemirror.min.js?v=20260127-02"></script>
    <script src="/static/vendor/codemirror/mode/python/python.min.js?v=20260127-02"></script>
    <script src="/static/vendor/codemirror/addon/comment/comment.min.js?v=20260127-02"></script>
    <script src="/static/vendor/codemirror/addon/hint/show-hint.min.js?v=20260127-02"></script>
    <script src="/static/vendor/codemirror/addon/hint/anyword-hint.min.js?v=20260127-02"></script>
    <script src="/static/vendor/lodash/lodash.min.js?v=20260127-02"></script>
    <script src="/static/vendor/sweetalert2/sweetalert2.all.min.js?v=20260127-02"></script>
    <script src="/static/usage.js?v=20260127-02" defer></script>
    <script src="/static/credit.js?v=20260127-02" defer></script>
    <link rel="apple-touch-icon" sizes="180x180" href="/static/logo/apple-touch-icon.png?v=20260127-02">
<link rel="icon" type="image/png" sizes="32x32" href="/static/logo/favicon-32x32.png?v=20260127-02">
<link rel="icon" type="image/png" sizes="16x16" href="/static/logo/favicon-16x16.png?v=20260127-02">
</head>
<body>
    <div class="toolbar">
        <button id="zoom-in-button" type="button" title="Zoom in" onclick="zoomIn()" aria-label="Zoom In">+</button>
        <button id="zoom-out-button" type="button" title="Zoom out" onclick="zoomOut()" aria-label="Zoom Out">-</button>
        <button id="reset-button" type="button" title="Reset view" onclick="resetView()" aria-label="Reset View">R</button>
        <div class="dropdown">
            <button id="catalog-button">Catalogs</button>
            <div id="catalog-dropdown" class="dropdown-content">
                <!-- Catalog items will be added here dynamically -->
                <a href="#" onclick="refreshCatalogs()">Refresh Catalogs</a>
            </div>
        </div>
        <div id="top-bar-custom-buttons" class="top-bar-section">
        </div>
        <!-- <span id="filename-display" style="margin-left: 10px; color: #ddd; font-size: 12px; align-self: center;">No file loaded</span> -->
    </div>
    <div id="openseadragon"></div>
    <div id="catalog-info" class="catalog-info"></div>

    <div id="plotter-container" style="display: none; width: 100%; height: 100%; position: relative;">
         <canvas id="plotter-canvas" style="position: absolute; top: 0; left: 0;"></canvas>
    </div>

    <div id="local-coding-run-controls" style="display:none;">
        <button id="local-run-button" class="coding-panel-button">
            <span class="play-icon">
                <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
            </span>
            <span class="button-text">Run</span>
        </button>
        <div id="local-run-loader" class="button-loader" style="display: none; margin-left: 10px;"></div>
    </div>

    <!-- Placeholder for FITS Header Modal -->
    <div id="fits-header-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" onclick="closeFitsHeaderModal()">&times;</span>
            <h2 id="fits-header-filename">FITS Header</h2>
            <input type="text" id="fits-header-search" placeholder="Search header...">
            <div id="fits-header-table-container">
                <!-- Header content will be loaded here -->
            </div>
        </div>
    </div>

</div> <!-- End of main-content -->
    <div id="coding-panel-container"></div>
<!-- <script src="jstat.min.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.4.2/openseadragon.min.js"></script> -->
    <script src="/static/coding.js?v=20260127-02"></script>
    <script>
      (function(){
        fetch('/settings/me').then(r=>r.json()).then(me=>{
          var btn=document.getElementById('local-coding-button');
          if (!btn) return;
          btn.style.display = (me && me.admin) ? '' : 'none';
        }).catch(()=>{});
      })();
    </script>

    <!-- UI Components -->
    <div id="notification-container"></div>
    
    <!-- Peak Finder Progress Bar -->
    <div id="progress-container" style="display: none; position: fixed; bottom: 20px; right: 20px; z-index: 1000; background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(20, 20, 20, 0.95)); backdrop-filter: blur(15px); border-radius: 50%; width: 90px; height: 90px; box-shadow: 0 8px 32px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.1); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; border: 2px solid rgba(76, 175, 80, 0.3);">
        <svg id="progress-svg" width="90" height="90" viewBox="0 0 36 36" style="transform: rotate(-90deg); filter: drop-shadow(0 0 8px rgba(76, 175, 80, 0.3));">
            <!-- Background ring with gradient -->
            <defs>
                <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#4CAF50"/>
                    <stop offset="100%" style="stop-color:#45a049"/>
                </linearGradient>
                <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:rgba(255,255,255,0.1)"/>
                    <stop offset="100%" style="stop-color:rgba(255,255,255,0.05)"/>
                </linearGradient>
            </defs>
            
            <!-- Background circle -->
            <circle class="progress-ring-bg" cx="18" cy="18" r="15.9155" fill="transparent" stroke="url(#bgGradient)" stroke-width="1.5" opacity="0.3"/>
            
            <!-- Main progress circle -->
            <circle id="progress-bar" class="progress-ring-circle" cx="18" cy="18" r="15.9155" fill="transparent" stroke="url(#progressGradient)" stroke-width="2.5" stroke-dasharray="100 100" stroke-dashoffset="100" stroke-linecap="round" style="transition: stroke-dashoffset 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;"/>
            
            <!-- ETA text -->
            <text id="progress-eta" x="18" y="20" font-size="5" font-weight="400" fill="rgba(255, 255, 255, 0.8)" text-anchor="middle" style="transform: rotate(90deg) translate(0, -36px); text-shadow: 0 1px 2px rgba(0,0,0,0.3);">Ready</text>
        </svg>
        
        <!-- Status indicator dot -->
        <div id="status-dot" style="position: absolute; top: 8px; right: 8px; width: 12px; height: 12px; border-radius: 50%; background: #4CAF50; border: 2px solid rgba(0, 0, 0, 0.8); opacity: 0; transition: all 0.3s ease; box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);"></div>
        
        <!-- Subtle glow effect -->
        <div style="position: absolute; inset: -2px; border-radius: 50%; background: conic-gradient(from 0deg, transparent, rgba(76, 175, 80, 0.1), transparent); opacity: 0; transition: opacity 0.3s ease;" id="glow-ring"></div>
    </div>
    <div id="download-progress-container" style="display: none;">
        <svg class="progress-ring" width="130" height="130">
            <circle id="progress-circle-bg" class="progress-ring__circle" stroke="#333" stroke-width="9" fill="transparent" r="58" cx="65" cy="65"/>
            <circle id="progress-circle-fg" class="progress-ring__circle" stroke="#2196F3" stroke-width="9" fill="transparent" r="58" cx="65" cy="65"/>
        </svg>
        <div id="progress-text">0%</div>
    </div>
</body>
</html>
